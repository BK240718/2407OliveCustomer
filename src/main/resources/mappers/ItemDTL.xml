<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.BK._OliveCustomer.dto.ItemDTLMapper">
    <select id="listItemDTLBySection" parameterType="itemDTL" resultType="ItemDTL">
        SELECT  *
        FROM
                    (SELECT  rownum rn, a.*
                    FROM
                            (Select  itDTL.itemDtlId, itDTL.itemId, itDTL.colorName,
                                    itDTL.purchasePrice, itDTL.salesPrice,
                                    itDTL.ItemDtlQty,
                                    itDTL.regDate, itDTL.STATUS,
                                    itDTL.THUMBNAIL, itDTL.detailImg, itDTL.colorImg,
                                    i.itemName,
                                    COALESCE(SUM(invDTL.invoiceDtlQty), 0) AS TOTAL_SALES
                            From    itemDTL itDTL, item i, section s, invoiceDTL invDTL
                            Where   itDTL.itemId = i.itemId
                            And     i.sectionId = s.sectionId
                            And     invDTL.itemDtlId = itDTL.itemDtlId
                            And     s.sectionId = #{sectionId}
                            GROUP BY itDTL.itemDtlId, itDTL.itemId, itDTL.colorName,
                                    itDTL.purchasePrice, itDTL.salesPrice,
                                    itDTL.ItemDtlQty, itDTL.regDate, itDTL.status,
                                    itDTL.THUMBNAIL, itDTL.detailImg, itDTL.colorImg,
                                    i.itemName
                            ORDER BY    TOTAL_SALES DESC,
                                        itDTL.itemDtlId DESC
                            ) a
                    )
        Where   rn Between #{start} AND #{end}
    </select>

    <select id="countItemDTLBySection" parameterType="int" resultType="int">
        Select  COUNT(*)
        From    itemDTL itDTL, item i, section s
        Where   itDTL.itemId = i.itemId
        And     i.sectionId = s.sectionId
        And     s.sectionId = #{sectionId}
    </select>
</mapper>